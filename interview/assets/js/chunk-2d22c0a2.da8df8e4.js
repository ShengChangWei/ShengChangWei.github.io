(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d22c0a2"],{f211:function(s,a,t){"use strict";t.r(a);var r=function(){var s=this,a=s.$createElement;s._self._c;return s._m(0)},n=[function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("section",[t("h1",[s._v("手动实现订阅发布模式（观察者模式）")]),t("pre",{pre:!0},[t("code",{pre:!0,attrs:{"v-pre":"",class:"language-javascript"}},[t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" Event = ("),t("span",{pre:!0,attrs:{class:"hljs-function"}},[t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),t("span",{pre:!0,attrs:{class:"hljs-params"}}),s._v(")")]),s._v("{\n    "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" clientList = [], \n        subscribe, \n        publish, \n        unsubscribe;\n    subscribe = "),t("span",{pre:!0,attrs:{class:"hljs-function"}},[t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),t("span",{pre:!0,attrs:{class:"hljs-params"}}),s._v(") ")]),s._v("{ "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("//订阅事件")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" ( !"),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".clientList[ key ] ){ "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 如果还没有订阅过此类消息，给该类消息创建一个缓存列表")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".clientList[ key ] = []; \n        } \n        "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".clientList[ key ].push( fn ); "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 订阅的消息添加进消息缓存列表")]),s._v("\n    };\n    publish = "),t("span",{pre:!0,attrs:{class:"hljs-function"}},[t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),t("span",{pre:!0,attrs:{class:"hljs-params"}}),s._v(") ")]),s._v("{\n        "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" key = "),t("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("Array")]),s._v(".prototype.shift.call( "),t("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("arguments")]),s._v(" ), "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 取出消息类型")]),s._v("\n        fns = "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".clientList[ key ]; "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 取出该消息对应的回调函数集合")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" ( !fns || fns.length === "),t("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("0")]),s._v(" ){ "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 如果没有订阅该消息，则返回")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"hljs-literal"}},[s._v("false")]),s._v("; \n        } \n        "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("for")]),s._v("( "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" i = "),t("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("0")]),s._v(", fn; fn = fns[ i++ ]; ){ \n            fn.apply( "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(", "),t("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("arguments")]),s._v(" ); "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// (2) // arguments 是发布消息时附送的参数")]),s._v("\n        }\n    };\n    unsubscribe = "),t("span",{pre:!0,attrs:{class:"hljs-function"}},[t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),t("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("key, fn")]),s._v(") ")]),s._v("{\n        "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("const")]),s._v(" t = "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".clientList[key];\n        "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" (!t) { "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 如果 key 对应的消息没有被人订阅，则直接返回")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"hljs-literal"}},[s._v("false")]),s._v(";\n        }\n        "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" (!fn) {\n            "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 如果不指定处理方法，则取消该事件下所有的处理方法")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("delete")]),s._v(" "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".clientList[key];\n            "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"hljs-literal"}},[s._v("true")]),s._v(";\n        }\n        "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 找到指定取消的处理方法的位置")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("const")]),s._v(" i = t.indexOf(fn);\n        "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" (i < "),t("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("0")]),s._v(") {\n            "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"hljs-literal"}},[s._v("false")]),s._v(";\n        }\n        t.splice(i, "),t("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("1")]),s._v(");\n        "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 如果事件下的处理方法为空则删除该事件")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" (!t.length) {\n            "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("delete")]),s._v(" "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".clientList[key];\n        }\n        "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"hljs-literal"}},[s._v("true")]),s._v(";\n    };\n    "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" { \n        "),t("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("subscribe")]),s._v(": listen, \n        "),t("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("publish")]),s._v(": trigger, \n        "),t("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("unsubscribe")]),s._v(": remove \n    }\n\n})()\n")])])])}],e=t("2877"),l={},p=Object(e["a"])(l,r,n,!1,null,null,null);a["default"]=p.exports}}]);
//# sourceMappingURL=chunk-2d22c0a2.da8df8e4.js.map