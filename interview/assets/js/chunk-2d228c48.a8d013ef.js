(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d228c48"],{db1e:function(s,a,r){"use strict";r.r(a);var t=function(){var s=this,a=s.$createElement;s._self._c;return s._m(0)},n=[function(){var s=this,a=s.$createElement,r=s._self._c||a;return r("section",[r("h1",[s._v("策略模式")]),r("h2",[s._v("1、定义")]),r("p",[s._v("策略模式：定义一系列的算法，把它们一个个封装起来，并且使它们可以相互替换。")]),r("h2",[s._v("2、使用策略模式计算奖金")]),r("p",[s._v("很多公司的年终奖是根据员工的工资基数和年底绩效情况来发放的。例如，绩效为 S 的人年终奖有 4 倍工资，绩效为 A 的人年终奖有 3 倍工资，而绩效为 B 的人年终奖是 2 倍工资。假设财务部要求我们提供一段代码，来方便他们计算员工的年终奖。")]),r("h3",[s._v("1. 最初的实现代码 --（缺点太多）")]),r("p",[s._v("编写calculateBonus函数接收两个参数： 员工的工资数额和他的绩效考核等级。\n代码如下：")]),r("pre",{pre:!0},[r("code",{pre:!0,attrs:{"v-pre":"",class:"language-javascript"}},[s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" ( performanceLevel === "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'S'")]),s._v(" ){ \n "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" salary * "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("4")]),s._v("; \n } \n "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" ( performanceLevel === "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'A'")]),s._v(" ){ \n "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" salary * "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("3")]),s._v("; \n } \n "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" ( performanceLevel === "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'B'")]),s._v(" ){ \n "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" salary * "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("2")]),s._v("; \n } \n}; \ncalculateBonus( "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'B'")]),s._v(", "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("20000")]),s._v(" ); "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 输出：40000 ")]),s._v("\ncalculateBonus( "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'S'")]),s._v(", "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("6000")]),s._v(" ); "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 输出：24000")]),s._v("\n")])]),r("p",[s._v("缺点：")]),r("ul",[r("li",[s._v("calculateBonus 函数比较庞大，包含了很多 if-else 语句，这些语句需要覆盖所有的逻辑\n分支。")]),r("li",[s._v("calculateBonus 函数缺乏弹性，如果增加了一种新的绩效等级 C，或者想把绩效 S 的奖金系数改为 5，那我们必须深入 calculateBonus 函数的内部实现，这是违反开放封闭原则的。")]),r("li",[s._v("算法的复用性差，如果在程序的其他地方需要重用这些计算奖金的算法呢？我们的选择只有复制和粘贴。")])]),r("h3",[s._v("2. 使用组合函数重构代码 ---（改善有限）")]),r("p",[s._v("代码如下：")]),r("pre",{pre:!0},[r("code",{pre:!0,attrs:{"v-pre":"",class:"language-javascript"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" performanceS = "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v(" salary ")]),s._v(")")]),s._v("{ \n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" salary * "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("4")]),s._v("; \n}; \n"),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("2")]),s._v(" \n"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" performanceA = "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v(" salary ")]),s._v(")")]),s._v("{ \n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" salary * "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("3")]),s._v("; \n}; \n"),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("3")]),s._v(" \n"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" performanceB = "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v(" salary ")]),s._v(")")]),s._v("{ \n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" salary * "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("2")]),s._v("; \n}; \n"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" calculateBonus = "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v(" performanceLevel, salary ")]),s._v(")")]),s._v("{\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" ( performanceLevel === "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'S'")]),s._v(" ){ \n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" performanceS( salary ); \n    } \n\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" ( performanceLevel === "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'A'")]),s._v(" ){ \n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" performanceA( salary ); \n    }\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" ( performanceLevel === "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'B'")]),s._v(" ){ \n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" performanceB( salary ); \n    }\n}; \ncalculateBonus( "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'A'")]),s._v(" , "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("10000")]),s._v(" ); "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 输出：30000 8")]),s._v("\n")])]),r("p",[s._v("缺点： 这种改善非常有限，我们依然没有解决最重要的问题：calculateBonus 函数有可能越来越庞大，而且在系统变化的时候缺乏弹性。")]),r("h3",[s._v("3. 使用策略模式重构代码（模仿传统面向对象语言中的实现）（作为了解）")]),r("pre",{pre:!0},[r("code",{pre:!0,attrs:{"v-pre":"",class:"language-javascript"}},[r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 绩效S")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" performanceS = "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}}),s._v(")")]),s._v("{};\nperformanceS.prototype.calculate = "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("salary")]),s._v(") ")]),s._v("{\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" salary * "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("4")]),s._v(";\n}\n"),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 绩效A")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" performanceA = "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}}),s._v(")")]),s._v("{};\nperformanceA.prototype.calculate = "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("salary")]),s._v(") ")]),s._v("{\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" salary * "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("3")]),s._v(";\n}\n"),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 绩效B")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" performanceA = "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}}),s._v(")")]),s._v("{};\nperformanceA.prototype.calculate = "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("salary")]),s._v(") ")]),s._v("{\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" salary * "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("2")]),s._v(";\n}\n\n"),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 定义奖金类Bonus")]),s._v("\n\n"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" Bonus = "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}}),s._v(") ")]),s._v("{\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".salary = "),r("span",{pre:!0,attrs:{class:"hljs-literal"}},[s._v("null")]),s._v("; "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 原始工资")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".strategy = "),r("span",{pre:!0,attrs:{class:"hljs-literal"}},[s._v("null")]),s._v("; "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 绩效等级对应的策略对象")]),s._v("\n}\nBonus.prototype.setSalary = "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("salary")]),s._v(") ")]),s._v("{\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".salary = salary; "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 设置员工的原始工资")]),s._v("\n}\nBonus.prototype.setStrategy = "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("strategy")]),s._v(") ")]),s._v("{\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".strategy = strategy; "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 设置员工绩效等级对应的策略对象")]),s._v("\n}\nBonus.prototype.getBonus = "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}}),s._v(") ")]),s._v("{\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".strategy.calculate("),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".salary); "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 把计算奖金的操作委托给对应的策略对象")]),s._v("\n}\n\n"),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 使用")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" bonus = "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("new")]),s._v(" Bonus(); bonus.setSalary( "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("10000")]),s._v(" ); \nbonus.setStrategy( "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("new")]),s._v(" performanceS() ); "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 设置策略对象")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("console")]),s._v(".log( bonus.getBonus() ); "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 输出：40000 ")]),s._v("\nbonus.setStrategy( "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("new")]),s._v(" performanceA() ); "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 设置策略对象")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("console")]),s._v(".log( bonus.getBonus() ); "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 输出：30000")]),s._v("\n")])]),r("p",[s._v("这段代码是基于传统面向对象语言模仿，自我感觉太过啰嗦，一些比较少的判断太过啰嗦")]),r("h2",[s._v("3、JavaScript 版本的策略模式 （平时自己写代码用的比较多的思想）")]),r("p",[s._v("上一节我们让 strategy 对象从各个策略类中创建而来，这是模拟一些传统面向对象语言的实现。实际上在 JavaScript 语言中，函数也是对象，所以更简单和直接的做法是把 strategy直接定义为函数：")]),r("pre",{pre:!0},[r("code",{pre:!0,attrs:{"v-pre":"",class:"language-javascript"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" strategies = {\n    "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'S'")]),s._v(":"),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("salary")]),s._v(") ")]),s._v("{\n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" salary * "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("4")]),s._v(";\n    },\n    "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'A'")]),s._v(":"),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("salary")]),s._v(") ")]),s._v("{\n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" salary * "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("3")]),s._v(";\n    },\n    "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'B'")]),s._v(":"),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("salary")]),s._v(") ")]),s._v("{\n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" salary * "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("2")]),s._v(";\n    }\n}\n"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" calculateBonus = "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v(" level, salary ")]),s._v(")")]),s._v("{ \n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" strategies[ level ]( salary ); \n};\n"),r("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("console")]),s._v(".log( calculateBonus( "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'S'")]),s._v(", "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("20000")]),s._v(" ) ); "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 输出：80000 ")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("console")]),s._v(".log( calculateBonus( "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'A'")]),s._v(", "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("10000")]),s._v(" ) ); "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 输出：30000")]),s._v("\n")])]),r("p",[s._v("在自己平时项目开发中，遇到许多if-else判断时，首先考虑到将这些不变的条件独立封装成一个对象，然后根据判断条件从对象中获取对应的值，在这里多说几句，其实个人感觉我们在实际开发中或多或少的都用到一些设计模式，只是自己没有将一些思想提取出来，没有归类总结。而学习设计模式正是将我们实际开发中自己用到的一些思想归类，将那种模糊想要抓住的思想用一个名称去标识，下次遇到同样的业务问题可以很快的定位到自己要使用的模式，这是一种提升，废话少说，继续下文。")]),r("h2",[s._v("4、策略模式 -- 表单验证")]),r("p",[s._v("规则：")]),r("ul",[r("li",[s._v("用户名不能为空")]),r("li",[s._v("密码长度不能少于6位")]),r("li",[s._v("手机密码必须符合格式")])]),r("h3",[s._v("4.1 第一版本（最基础的）")]),r("blockquote",[r("p",[s._v("html")])]),r("pre",{pre:!0},[r("code",{pre:!0,attrs:{"v-pre":"",class:"language-html"}},[r("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("<"),r("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("form")]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("action")]),s._v("="),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"http:// xxx.com/register"')]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("id")]),s._v("="),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"registerForm"')]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("method")]),s._v("="),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"post"')]),s._v(">")]),s._v("\n   请输入用户名："),r("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("<"),r("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("input")]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("type")]),s._v("="),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"text"')]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("name")]),s._v("="),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"userName"')]),s._v("/ >")]),s._v("\n   请输入密码： "),r("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("<"),r("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("input")]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("type")]),s._v("="),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"text"')]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("name")]),s._v("="),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"password"')]),s._v("/ >")]),s._v("\n   请输入手机号码："),r("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("<"),r("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("input")]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("type")]),s._v("="),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"text"')]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("name")]),s._v("="),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"phoneNumber"')]),s._v("/ >")]),s._v(" \n   "),r("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("<"),r("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("button")]),s._v(">")]),s._v("提交"),r("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("</"),r("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("button")]),s._v(">")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("</"),r("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("form")]),s._v(">")]),s._v("\n")])]),r("blockquote",[r("p",[s._v("js")])]),r("pre",{pre:!0},[r("code",{pre:!0,attrs:{"v-pre":"",class:"language-javascript"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" registerForm = "),r("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("document")]),s._v(".getElementById( "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'registerForm'")]),s._v(" ); \nregisterForm.onsubmit = "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}}),s._v(")")]),s._v("{ \n   "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" ( registerForm.userName.value === "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("''")]),s._v(" ){ \n       alert ( "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'用户名不能为空'")]),s._v(")\n       "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-literal"}},[s._v("false")]),s._v("; \n   } \n   "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" ( registerForm.password.value.length < "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("6")]),s._v(" ){ \n       alert ( "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'密码长度不能少于 6 位'")]),s._v(" ); \n       "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-literal"}},[s._v("false")]),s._v("; \n   } \n   "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" ( !"),r("span",{pre:!0,attrs:{class:"hljs-regexp"}},[s._v("/(^1[3|5|8][0-9]{9}$)/")]),s._v(".test( registerForm.phoneNumber.value ) ){ \n         alert ( "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'手机号码格式不正确'")]),s._v(" ); \n       "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-literal"}},[s._v("false")]),s._v("; \n     \n   } \n}\n")])]),r("p",[s._v("缺点:")]),r("ul",[r("li",[s._v("registerForm.onsubmit 函数比较庞大，包含了很多 if-else 语句，这些语句需要覆盖所有的校验规则。")]),r("li",[s._v("registerForm.onsubmit 函数缺乏弹性，如果增加了一种新的校验规则，或者想把密码的长度校验从 6 改成 8，我们都必须深入 registerForm.onsubmit 函数的内部实现，这是违反开放—封闭原则的。")]),r("li",[s._v("算法的复用性差，如果在程序中增加了另外一个表单，这个表单也需要进行一些类似的校验，那我们很可能将这些校验逻辑复制得漫天遍野。")])]),r("h3",[s._v("4.2 策略模式重构表单校验")]),r("p",[s._v("代码如下：")]),r("pre",{pre:!0},[r("code",{pre:!0,attrs:{"v-pre":"",class:"language-javascript"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" strategies = {\n    "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("isNonEmpty")]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("value, errorMsg")]),s._v(") ")]),s._v("{ "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 不能为空")]),s._v("\n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v("(value === "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("''")]),s._v(") {\n            "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" errorMsg;\n        }\n    },\n    "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("minLength")]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("value, length, errorMsg")]),s._v(") ")]),s._v("{ "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 限制长度")]),s._v("\n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v("(value.length < length) {\n            "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" errorMsg;\n        }\n    },\n    "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("isMobile")]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("value, errorMsg")]),s._v(") ")]),s._v("{\n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v("( !"),r("span",{pre:!0,attrs:{class:"hljs-regexp"}},[s._v("/(^1[3|5|8][0-9]{9}$)/")]),s._v(".test( value )) {\n            "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" errorMsg;l\n        }\n    }\n}\n\n")])]),r("p",[s._v("接下来我们准备实现 Validator 类。Validator 类在这里作为 Context，负责接收用户的请求并委托给 strategy 对象。在给出 Validator 类的代码之前，有必要提前了解用户是如何向 Validator类发送请求的，这有助于我们知道如何去编写 Validator 类的代码。代码如下：")]),r("pre",{pre:!0},[r("code",{pre:!0,attrs:{"v-pre":"",class:"language-javascript"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" validataFunc = "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}}),s._v(") ")]),s._v("{\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" validator = "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("new")]),s._v(" Validator(); "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 创建一个对象 Validtor类在下面")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("/*****************添加一些校验规则*******************/")]),s._v("\n    validator.add(registerForm.userName, "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'isNonEmpty'")]),s._v(", "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'用户名不能为空'")]),s._v(");\n    validator.add(registerForm.password, "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'minLength:6'")]),s._v(", "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'密码长度不能少于6位 '")]),s._v(");\n    validator.add(registerForm.phoneNumber, "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'isMobile'")]),s._v(", "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'手机号码格式不正确'")]),s._v(");\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" errorMsg = validator.start(); "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 获得校验结果")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" errorMsg; "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 返回校验结果")]),s._v("\n}\n "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" registerForm = "),r("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("document")]),s._v(".getElementById( "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'registerForm'")]),s._v(" );\n registerForm.onsubmit = "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}}),s._v(") ")]),s._v("{\n     "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" errorMsg = validataFunc();\n     "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v("(errorMsg) {\n         alert(errorMsg);\n         "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-literal"}},[s._v("false")]),s._v(";\n     }\n }\n")])]),r("p",[s._v("最后是Validator类的实现")]),r("pre",{pre:!0},[r("code",{pre:!0,attrs:{"v-pre":"",class:"language-javascript"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" Validator = "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}}),s._v(") ")]),s._v("{\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".cache = [];\n};\nValidator.prototype.add = "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("dom, rule, errorMsg")]),s._v(") ")]),s._v("{\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" ary = rule.split("),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("':'")]),s._v(");\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".cache.push("),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}}),s._v(") ")]),s._v("{\n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" strategy = ary.shift();\n        ary.unshift(dom.value);\n        ary.push(errorMsg);\n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" strategies[strategy].apply(dom, ary);\n    })\n};\nValidator.prototype.start = "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}}),s._v(") ")]),s._v("{\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("for")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" i = "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("0")]),s._v(", validatorFunc; validatorFunc = "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".cache[ i++ ];) {\n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" msg = validatorFunc();\n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" ( msg ){ "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 如果有确切的返回值，说明校验没有通过")]),s._v("\n            "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" msg; \n        }\n    }\n}\n")])]),r("h3",[s._v("4.3 给某个文本输入框添加多种校验规则")]),r("p",[s._v("期待校验方式：")]),r("pre",{pre:!0},[r("code",{pre:!0,attrs:{"v-pre":"",class:"language-javascript"}},[s._v("validator.add( registerForm.userName, \n    [{ \n        "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("errorMsg")]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'用户名不能为空'")]),s._v(" \n        "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("strategy")]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'isNonEmpty'")]),s._v(", \n    }, { \n        "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("strategy")]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'minLength:6'")]),s._v(", \n        "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("errorMsg")]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'用户名长度不能小于 10 位'")]),s._v(" \n    }] \n );\n")])]),r("p",[s._v("下面提供的代码可用于一个文本输入框对应多种校验规则：")]),r("pre",{pre:!0},[r("code",{pre:!0,attrs:{"v-pre":"",class:"language-html"}},[r("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("<"),r("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("form")]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("action")]),s._v("="),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"http:// xxx.com/register"')]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("id")]),s._v("="),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"registerForm"')]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("method")]),s._v("="),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"post"')]),s._v(">")]),s._v(" \n    请输入用户名："),r("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("<"),r("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("input")]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("type")]),s._v("="),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"text"')]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("name")]),s._v("="),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"userName"')]),s._v("/ >")]),s._v(" \n    请输入密码："),r("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("<"),r("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("input")]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("type")]),s._v("="),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"text"')]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("name")]),s._v("="),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"password"')]),s._v("/ >")]),s._v(" \n    请输入手机号码："),r("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("<"),r("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("input")]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("type")]),s._v("="),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"text"')]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("name")]),s._v("="),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"phoneNumber"')]),s._v("/ >")]),s._v(" \n    "),r("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("<"),r("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("button")]),s._v(">")]),s._v("提交"),r("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("</"),r("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("button")]),s._v(">")]),s._v(" \n"),r("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("</"),r("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("form")]),s._v(">")]),s._v("\n")])]),r("pre",{pre:!0},[r("code",{pre:!0,attrs:{"v-pre":"",class:"language-javascript"}},[r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("/***********************策略对象**************************/")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" strategies = { \n    "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("isNonEmpty")]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v(" value, errorMsg ")]),s._v(")")]),s._v("{ \n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" ( value === "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("''")]),s._v(" ){ \n            "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" errorMsg; \n        } \n    }, \n    "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("minLength")]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v(" value, length, errorMsg ")]),s._v(")")]),s._v("{ \n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" ( value.length < length ){ \n            "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" errorMsg; \n        } \n    }, \n    "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("isMobile")]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v(" value, errorMsg ")]),s._v(")")]),s._v("{ \n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" ( !"),r("span",{pre:!0,attrs:{class:"hljs-regexp"}},[s._v("/(^1[3|5|8][0-9]{9}$)/")]),s._v(".test( value ) ){ \n            "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" errorMsg; \n        } \n    } \n };\n "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("/***********************Validator 类**************************/")]),s._v("\n "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" Validator = "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}}),s._v(")")]),s._v("{ \n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".cache = []; \n };\n Validator.prototype.add = "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v(" dom, rules ")]),s._v(")")]),s._v("{ \n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" self = "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v("; \n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("for")]),s._v(" ( "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" i = "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("0")]),s._v(", rule; rule = rules[ i++ ]; ){ \n        ("),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v(" rule ")]),s._v(")")]),s._v("{ \n            "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" strategyAry = rule.strategy.split( "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("':'")]),s._v(" ); \n            "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" errorMsg = rule.errorMsg; \n            self.cache.push("),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}}),s._v(")")]),s._v("{ \n                "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" strategy = strategyAry.shift();\n                strategyAry.unshift( dom.value ); \n                strategyAry.push( errorMsg );\n                "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" strategies[ strategy ].apply( dom, strategyAry ); \n        }); \n        })( rule ) \n    } \n };\n Validator.prototype.start = "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}}),s._v(")")]),s._v("{  \n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("for")]),s._v(" ( "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" i = "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("0")]),s._v(", validatorFunc; validatorFunc = "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".cache[ i++ ]; ){ \n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" errorMsg = validatorFunc(); \n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" ( errorMsg ){ \n            "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" errorMsg; \n        } \n    } \n };\n "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("/***********************客户调用代码**************************/")]),s._v(" \n "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" registerForm = "),r("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("document")]),s._v(".getElementById( "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'registerForm'")]),s._v(" ); \n "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" validataFunc = "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}}),s._v(")")]),s._v("{ \n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" validator = "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("new")]),s._v(" Validator(); \n        validator.add( registerForm.userName, [{ \n        "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("strategy")]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'isNonEmpty'")]),s._v(", \n        "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("errorMsg")]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'用户名不能为空'")]),s._v(" \n        }, { \n        "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("strategy")]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'minLength:6'")]),s._v(", \n        "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("errorMsg")]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'用户名长度不能小于 10 位'")]),s._v(" \n        }]); \n        validator.add( registerForm.password, [{ \n        "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("strategy")]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'minLength:6'")]),s._v(", \n        "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("errorMsg")]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'密码长度不能小于 6 位'")]),s._v(" \n        }]); \n        validator.add( registerForm.phoneNumber, [{ \n        "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("strategy")]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'isMobile'")]),s._v(", \n        "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("errorMsg")]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'手机号码格式不正确'")]),s._v(" \n        }]); \n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" errorMsg = validator.start(); \n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" errorMsg; \n } \n registerForm.onsubmit = "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}}),s._v(")")]),s._v("{ \n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" errorMsg = validataFunc(); \n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" ( errorMsg ){ \n        alert ( errorMsg ); \n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-literal"}},[s._v("false")]),s._v("; \n    }\n };\n")])]),r("h2",[s._v("5、策略模式的优缺点")]),r("p",[s._v("优点：")]),r("ul",[r("li",[s._v("策略模式利用组合、委托和多态等技术和思想，可以有效地避免多重条件选择语句。")]),r("li",[s._v("策略模式提供了对开放—封闭原则的完美支持，将算法封装在独立的 strategy 中，使得它们易于切换，易于理解，易于扩展。")]),r("li",[s._v("策略模式中的算法也可以复用在系统的其他地方，从而避免许多重复的复制粘贴工作。")]),r("li",[s._v("在策略模式中利用组合和委托来让 Context 拥有执行算法的能力，这也是继承的一种更轻便的替代方案。")])]),r("p",[s._v("缺点：（了解）")]),r("ul",[r("li",[s._v("使用策略模式会在程序中增加许多策略类或者策略对象，但实际上这比把它们负责的逻辑堆砌在 Context 中要好。")]),r("li",[s._v("要使用策略模式，必须了解所有的 strategy，必须了解各个 strategy 之间的不同点，这样才能选择一个合适的 strategy。违反最少知识原则的。")])]),r("h2",[s._v("6、小结")]),r("p",[s._v("在平时项目开发中，遇到许多if-else判断时，首先考虑策略模式的思想，将一些不变的东西单独封装成对象或函数。")])])}],e=r("2877"),l={},p=Object(e["a"])(l,t,n,!1,null,null,null);a["default"]=p.exports}}]);
//# sourceMappingURL=chunk-2d228c48.a8d013ef.js.map